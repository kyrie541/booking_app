<% include partials/header %> 

<div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel" data-interval=false>
  <div class="carousel-inner">
    <div class="carousel-item active">
		<% include table/table1 %> 
    </div>
    <div class="carousel-item">
		<% include table/table2 %> 
    </div>
     <div class="carousel-item">
		<% include table/table3 %> 
    </div>
  </div>
  <!-- Carousel Buttons Next/Prev -->
	<a data-slide="prev" href="#carouselExampleFade" class="left carousel-control">Previous</a>
	<a data-slide="next" href="#carouselExampleFade" class="right carousel-control">Next</a>
</div>

<a href="/card">Card View</a><br>

<script>
var all_timing = ["8am", "8.30am","9am","9.30am", "10am", "10.30am", "11am", "11.30am", "12pm", "12.30pm", "1pm", "1.30pm", "2pm", "2.30pm", "3pm", "3.30pm", "4pm", "4.30pm", "5pm", "5.30pm", "6pm", "6.30pm", "7pm", "7.30pm", "8pm", "8.30pm", "9pm", "9.30pm", "10pm", "10.30pm", "11pm", "11.30pm", "12am", "12.30am", "1am", "1.30am", "2am", "2.30am", "3am"];

var badminton_table = document.getElementsByClassName("badminton_table"); 
var P1_row_of_first_table= badminton_table[0].children[0].children[1];
var P1_row_of_second_table= badminton_table[1].children[0].children[1];
var P1_row_of_third_table= badminton_table[2].children[0].children[1];

var database_P1_array = []; 

//get the necessary data from database and convert to array
<% bookings.forEach(function(booking){ %>
    var courtNumString = "<%= booking.courtNum %>";
    if(courtNumString.split(",").includes("P1")){
        database_P1_array.push([{name:"<%= booking.name %>",contactNum:"<%= booking.phNumber %>",status:"<%= booking.status %>",id:"<%= booking._id %>"},["<%= booking.courtNum %>", "<%= booking.startTime %>","<%= booking.endTime %>"]]);
    }
<% }); %>

for (var i2=0; i2<database_P1_array.length; i2++){
    for(var i3=0; i3<database_P1_array[i2][1][0].split(",").length; i3++){
        if(database_P1_array[i2][1][0].split(",")[i3] =="P1"){
            var haha= database_P1_array[i2][1][0].split(",")[i3];
            database_P1_array[i2].push([database_P1_array[i2][1][1].split(",")[i3]+ "," +database_P1_array[i2][1][2].split(",")[i3]]);
        }   
    }
    database_P1_array[i2].splice(1,1);
}

console.log(database_P1_array);  //outcome: [[{name: "Koh9", contactNum: "888"},"11pm,1am"], [{name: "Koh", contactNum: "999"},"8am,10am"], [{name: "Koh5", contactNum: "01612345678"},"3pm,5pm","1.30pm,2.30pm"] 

//convert to combined array
for(var i4=0; i4<database_P1_array.length ;i4++){
    for(var i5=1; i5<database_P1_array[i4].length; i5++ ){
            var startTime = database_P1_array[i4][i5][0].split(",")[0];  //"11pm"
            var endTime = database_P1_array[i4][i5][0].split(",")[1];    //"1am"
            
            var indexNum_of_start_time = all_timing .findIndex(function(timing){ return timing == startTime});
            var indexNum_of_end_time = all_timing .findIndex(function(timing){ return timing == endTime});
            var one_point_array =[];
            for (var i7=indexNum_of_start_time; i7<=indexNum_of_end_time ; i7++ ){
                one_point_array.push(all_timing[i7]);
            }
            for (var i6=0 ; i6< one_point_array.length-1 ; i6++) {
                database_P1_array[i4].push(one_point_array[i6].toString()+"-"+one_point_array[i6+1].toString()); 
            }
    }
}
console.log(database_P1_array); 

//clear the redundant array
for(var i7=0 ; i7<database_P1_array.length ;i7++){
    if(Array.isArray(database_P1_array[i7][5])){
        database_P1_array[i7].splice(1, 5);
    }
    if(Array.isArray(database_P1_array[i7][4])){
        database_P1_array[i7].splice(1, 4);
    }
    if(Array.isArray(database_P1_array[i7][3])){
        database_P1_array[i7].splice(1, 3);
    }
    if(Array.isArray(database_P1_array[i7][2])){
        database_P1_array[i7].splice(1, 2);
    }
    if(Array.isArray(database_P1_array[i7][1])){
        database_P1_array[i7].splice(1, 1);
    }
}

console.log(database_P1_array); 

//iteration of database_P1_array to timing
// for(var i8=0; i8<database_P1_array.length; i8++){
//     for(var i9=1; i9<database_P1_array[i8].length; i9++){
//         console.log(database_P1_array[i8][i9]); 
//     }
// }

//iteration of P1 table row to timing
// for(var i10=1; i10<P1_row_of_first_table.children.length; i10++){
//     console.log(P1_row_of_first_table.children[i10].innerHTML); 
// }

//first table for loop
for(var i8=0; i8<database_P1_array.length; i8++){
    for(var i9=1; i9<database_P1_array[i8].length; i9++){
        for(var i10=1; i10<P1_row_of_first_table.children.length; i10++){
            if(database_P1_array[i8][i9]==P1_row_of_first_table.children[i10].innerHTML){
                P1_row_of_first_table.children[i10].innerHTML="<a href='/booking/"+database_P1_array[i8][0].id+"'>" + database_P1_array[i8][0].name + "</a><br>"+database_P1_array[i8][0].contactNum;
                
                
            }; 
        }
    }
}

//second table for loop
for(var i8=0; i8<database_P1_array.length; i8++){
    for(var i9=1; i9<database_P1_array[i8].length; i9++){
        for(var i10=1; i10<P1_row_of_second_table.children.length; i10++){
            if(database_P1_array[i8][i9]==P1_row_of_second_table.children[i10].innerHTML){
                P1_row_of_second_table.children[i10].innerHTML="<a href='/booking/"+database_P1_array[i8][0].id+"'>" + database_P1_array[i8][0].name + "</a><br>"+database_P1_array[i8][0].contactNum;
            }; 
        }
    }
}

//third table for loop
for(var i8=0; i8<database_P1_array.length; i8++){
    for(var i9=1; i9<database_P1_array[i8].length; i9++){
        for(var i10=1; i10<P1_row_of_third_table.children.length; i10++){
            if(database_P1_array[i8][i9]==P1_row_of_third_table.children[i10].innerHTML){
                P1_row_of_third_table.children[i10].innerHTML="<a href='/booking/"+database_P1_array[i8][0].id+"'>" + database_P1_array[i8][0].name + "</a><br>"+database_P1_array[i8][0].contactNum;
            }; 
        }
    }
}


</script>


<% include partials/footer %> 